<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="/css/colors.css" rel="stylesheet">
  <link href="/css/dashboard.css" rel="stylesheet">
  <%- include('../partials/navbar-styles') %>
</head>
<body>
  <%- include('../partials/navbar-dashboard') %>
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h3 class="mb-1"><i class="fas fa-truck me-2"></i><%= heading %></h3>
        <div class="text-muted">
          Cliente #<%= cliente.Id || cliente.id %> · <strong><%= cliente.Nombre_Razon_Social || cliente.Nombre || cliente.nombre || '—' %></strong>
        </div>
      </div>
      <a href="/dashboard/clientes/<%= cliente.Id || cliente.id %>/direcciones-envio" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-1"></i>Volver
      </a>
    </div>

    <% if (error) { %>
      <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
      </div>
    <% } %>

    <% const v = values || {}; %>
    <form method="POST" action="<%= action %>">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label fw-semibold">Alias</label>
              <input class="form-control" name="Alias" value="<%= v.Alias || '' %>" placeholder="Ej: Almacén, Farmacia, Dirección 2...">
              <div class="form-text">Se usa para identificar la dirección al seleccionar en pedidos.</div>
            </div>

            <div class="col-md-8">
              <label class="form-label fw-semibold">Nombre destinatario</label>
              <input class="form-control" name="Nombre_Destinatario" value="<%= v.Nombre_Destinatario || '' %>" placeholder="Ej: Farmacia X / Atención a...">
            </div>

            <div class="col-md-8">
              <label class="form-label fw-semibold">Dirección</label>
              <input class="form-control" name="Direccion" value="<%= v.Direccion || '' %>" placeholder="Calle, número, piso...">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Dirección 2</label>
              <input class="form-control" name="Direccion2" value="<%= v.Direccion2 || '' %>" placeholder="Portal, nave, puerta...">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Código postal</label>
              <input class="form-control" name="CodigoPostal" value="<%= v.CodigoPostal || '' %>" placeholder="00000">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Población</label>
              <input class="form-control" name="Poblacion" value="<%= v.Poblacion || '' %>">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Provincia</label>
              <select class="form-select" name="Id_Provincia">
                <option value="">—</option>
                <% (provincias || []).forEach(p => { %>
                  <option value="<%= p.id || p.Id %>" <%= String(v.Id_Provincia || '') === String(p.id || p.Id) ? 'selected' : '' %>><%= p.Nombre || p.nombre || '' %></option>
                <% }) %>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Teléfono</label>
              <input class="form-control" name="Telefono" value="<%= v.Telefono || '' %>">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Email</label>
              <input class="form-control" name="Email" value="<%= v.Email || '' %>">
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Contacto (opcional)</label>
              <select class="form-select" name="Id_Contacto">
                <option value="">—</option>
                <% (contactosCliente || []).forEach(r => { %>
                  <% const contactoId = r.Id_Contacto || r.Id || r.id; %>
                  <% const nombre = ((r.Apellidos || '') + ' ' + (r.Nombre || '')).trim() || (r.Nombre || 'Contacto'); %>
                  <option value="<%= contactoId %>" <%= String(v.Id_Contacto || '') === String(contactoId) ? 'selected' : '' %>><%= nombre %></option>
                <% }) %>
              </select>
              <div class="form-text">Se usa como referencia; no es obligatorio.</div>
            </div>

            <div class="col-12">
              <label class="form-label fw-semibold">Observaciones</label>
              <textarea class="form-control" name="Observaciones" rows="3"><%= v.Observaciones || '' %></textarea>
            </div>

            <div class="col-md-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="chkPrincipal" name="Es_Principal" value="1" <%= Number(v.Es_Principal) === 1 ? 'checked' : '' %>>
                <label class="form-check-label" for="chkPrincipal">Marcar como principal</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="chkActiva" name="Activa" value="1" <%= (v.Activa === undefined || v.Activa === null) ? 'checked' : (Number(v.Activa) === 1 ? 'checked' : '') %>>
                <label class="form-check-label" for="chkActiva">Activa</label>
              </div>
            </div>

            <div class="col-12 d-flex justify-content-end gap-2 mt-2">
              <a href="/dashboard/clientes/<%= cliente.Id || cliente.id %>/direcciones-envio" class="btn btn-outline-secondary">Cancelar</a>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i>Guardar
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

