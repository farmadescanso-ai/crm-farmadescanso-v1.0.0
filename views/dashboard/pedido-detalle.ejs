<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/colors.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">
    <style>
        .articulo-search-container {
            position: relative;
        }
        .articulo-search-input {
            width: 100%;
            padding: 0.375rem 2.5rem 0.375rem 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
        }
        .articulo-search-input:focus {
            border-color: #86b7fe;
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        .articulo-search-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            pointer-events: none;
        }
        .articulo-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            display: none;
        }
        .articulo-dropdown.show {
            display: block;
        }
        .articulo-dropdown-item {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        .articulo-dropdown-item:hover {
            background-color: #f8f9fa;
        }
        .articulo-dropdown-item:last-child {
            border-bottom: none;
        }
        .articulo-item-id {
            font-size: 0.875rem;
            color: #6c757d;
            font-weight: 600;
        }
        .articulo-item-name {
            font-weight: 500;
        }
    </style>

    <%- include('../partials/navbar-styles') %></head>
<body>
    <%- include('../partials/navbar-dashboard') %>

    <div class="container py-4">
        <% if (query && query.success === 'pedido_creado') { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>Pedido creado correctamente.
            <% if (query.numero) { %>
                Nº de pedido asignado: <strong><%= query.numero %></strong>.
            <% } %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        <% } %>
        <% if (query && query.success === 'pedido_actualizado') { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>El pedido se actualizó correctamente.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <% } %>
        <% if (query && query.success === 'estado_actualizado') { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>El estado del pedido cambió correctamente.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <% } %>
        <% if (query && query.success === 'linea_agregada') { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>Línea añadida correctamente al pedido.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <% } %>
        <% if (query && query.success === 'pedido_cerrado') { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>El pedido se cerró correctamente.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <% } %>
        <% if (query && query.error) { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <% if (query.error === 'linea_no_agregada') { %>
                No se pudo añadir la línea al pedido. Inténtalo de nuevo.
            <% } else if (query.error === 'linea_datos_invalidos') { %>
                Revisa los datos de la línea (artículo y cantidad deben ser válidos).
            <% } else if (query.error === 'linea_estado_no_permitido') { %>
                Solo puedes añadir líneas cuando el pedido está en estado Pendiente.
            <% } else if (query.error === 'pedido_no_encontrado') { %>
                El pedido no existe o fue eliminado.
            <% } else if (query.error === 'pedido_cerrado') { %>
                El pedido está cerrado y no se permite modificarlo.
            <% } else { %>
                No se pudo completar la acción solicitada.
            <% } %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <% } %>

        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                    <div>
                        <div class="d-flex align-items-center gap-3 mb-2">
                            <a href="/dashboard/pedidos" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Volver a Pedidos
                            </a>
                            <h3 class="fw-bold mb-0">Pedido #<%= pedido.numero || pedido.id %></h3>
                        </div>
                        <p class="text-muted mb-0">Cliente: <strong><%= pedido.cliente %></strong></p>
                        <p class="text-muted mb-0">Comercial: <%= pedido.comercial %></p>
                    </div>
                    <div class="text-end">
                        <% 
                        // Función para obtener la clase CSS según el estado del pedido
                        function getEstadoClass(estado) {
                            if (!estado) return 'bg-secondary';
                            const estadoLower = estado.toLowerCase();
                            
                            if (estadoLower === 'pendiente' || estadoLower.includes('pend')) {
                                return 'bg-warning text-dark';
                            } else if (estadoLower === 'tramitado' || estadoLower.includes('tramit')) {
                                return 'bg-info text-white';
                            } else if (estadoLower === 'enviado' || estadoLower.includes('envi')) {
                                return 'bg-primary text-white';
                            } else if (estadoLower === 'entregado' || estadoLower.includes('entreg')) {
                                return 'bg-success text-white';
                            } else if (estadoLower === 'cancelado' || estadoLower === 'anulado' || estadoLower.includes('cancel') || estadoLower.includes('anul')) {
                                return 'bg-secondary text-white';
                            } else if (estadoLower === 'cerrado' || estadoLower.includes('cerr')) {
                                return 'bg-dark text-white';
                            } else {
                                return 'bg-secondary text-white';
                            }
                        }
                        const estadoPedido = pedido.estado || 'Pendiente';
                        const estadoClass = getEstadoClass(estadoPedido);
                        %>
                        <span class="badge fs-6 <%= estadoClass %>">
                            <%= estadoPedido %>
                        </span>
                        <div class="mt-3 d-flex gap-2 flex-wrap justify-content-end">
                            <a href="/dashboard/pedidos/<%= pedido.id %>/transporte" class="btn btn-outline-info btn-sm" target="_blank">
                                <i class="fas fa-truck me-1"></i>
                                Documento Transporte
                            </a>
                            <form method="post" action="/api/pedidos/<%= pedido.id %>/estado" class="d-inline">
                                <% const siguienteEstado = (pedido.estado || '').toLowerCase().includes('pend') ? 'Entregado' : 'Pendiente'; %>
                                <input type="hidden" name="estado" value="<%= siguienteEstado %>">
                                <input type="hidden" name="__fromDashboard" value="1">
                                <button type="submit" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-sync-alt me-1"></i>
                                    Cambiar a <%= siguienteEstado %>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="row mt-4 g-3">
                    <div class="col-md-3">
                        <div class="border rounded p-3 h-100">
                            <div class="text-muted small text-uppercase">Fecha de pedido</div>
                            <div class="fw-semibold"><%= pedido.fecha ? new Date(pedido.fecha).toLocaleDateString('es-ES') : '—' %></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border rounded p-3 h-100">
                            <div class="text-muted small text-uppercase">Fecha de entrega</div>
                            <div class="fw-semibold"><%= pedido.fechaEntrega ? new Date(pedido.fechaEntrega).toLocaleDateString('es-ES') : '—' %></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border rounded p-3 h-100">
                            <div class="text-muted small text-uppercase">Forma de pago</div>
                            <div class="fw-semibold"><%= pedido.formaPago || '—' %></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="border rounded p-3 h-100">
                            <div class="text-muted small text-uppercase">Tipo de pedido</div>
                            <div class="fw-semibold"><%= pedido.tipoPedido || '—' %></div>
                            <% if (pedido.tipoPedido && (pedido.tipoPedido.toLowerCase().includes('transfer'))) { %>
                                <% if (pedido.cooperativa_nombre || pedido.numero_cooperativa) { %>
                                    <div class="mt-2 pt-2 border-top">
                                        <div class="text-muted small text-uppercase">Cooperativa</div>
                                        <div class="fw-semibold"><%= pedido.cooperativa_nombre || '—' %></div>
                                        <% if (pedido.numero_cooperativa) { %>
                                            <div class="text-muted small mt-1">Nº Asociado: <strong><%= pedido.numero_cooperativa %></strong></div>
                                        <% } %>
                                    </div>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                </div>

                <% if (pedido.observaciones) { %>
                <div class="mt-3">
                    <div class="text-muted small text-uppercase">Observaciones</div>
                    <div class="alert alert-secondary mb-0"><%= pedido.observaciones %></div>
                </div>
                <% } %>
            </div>
        </div>

        <div class="card shadow-sm mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-list me-2"></i>Detalle de líneas</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Artículo</th>
                                <th class="text-center">Cantidad</th>
                                <th class="text-end">Precio</th>
                                <th class="text-end">Subtotal</th>
                                <th class="text-end">Total línea</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (lineas.length === 0) { %>
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox me-2"></i>Este pedido no tiene líneas asociadas.
                                </td>
                            </tr>
                            <% } else { %>
                                <% lineas.forEach(linea => { %>
                                <tr>
                                    <td><%= linea.articulo %></td>
                                    <td class="text-center"><%= formatearNumeroES(linea.cantidad || 0) %></td>
                                    <td class="text-end">€ <%= formatearMonedaES(linea.precio || 0, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                    <td class="text-end">€ <%= formatearMonedaES(linea.subtotal || 0, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                    <td class="text-end">€ <%= formatearMonedaES(linea.total || 0, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                </tr>
                                <% }) %>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-light">
                <div class="row justify-content-end">
                    <div class="col-md-4">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Subtotal</span>
                            <span class="fw-semibold">€ <%= formatearMonedaES(pedido.subtotal || 0, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Impuestos</span>
                            <span class="fw-semibold">€ <%= formatearMonedaES(pedido.impuestos || 0, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></span>
                        </div>
                        <div class="d-flex justify-content-between border-top pt-2 mt-2">
                            <span class="fw-semibold">Total</span>
                            <span class="fw-bold text-success">€ <%= formatearMonedaES(pedido.total || 0, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <% if (puedeAgregarLineas) { %>
        <div class="card shadow-sm mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0"><i class="fas fa-plus me-2"></i>Añadir nueva línea</h5>
                <span class="badge bg-info text-dark">Estado: Pendiente</span>
            </div>
            <div class="card-body">
                <!-- Búsqueda de artículos -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Buscar artículo para añadir</label>
                    <div class="articulo-search-container">
                        <input type="text" class="form-control articulo-search-input" id="busquedaArticuloCabecera" placeholder="Buscar por ID o nombre..." autocomplete="off">
                        <i class="fas fa-search articulo-search-icon"></i>
                        <div class="articulo-dropdown" id="dropdownArticuloCabecera"></div>
                    </div>
                </div>

                <!-- Modal para cantidad y descuento -->
                <div class="modal fade" id="modalCantidadDescuento" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Añadir artículo</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Artículo seleccionado</label>
                                    <div class="form-control-plaintext" id="modalArticuloNombre"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="modalCantidad" class="form-label">Cantidad <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="modalCantidad" min="1" step="1" value="1" required>
                                </div>
                                <div class="mb-3">
                                    <label for="modalDescuento" class="form-label">Descuento (%)</label>
                                    <input type="number" class="form-control" id="modalDescuento" min="0" max="100" step="0.01" value="0">
                                    <small class="text-muted">Porcentaje de descuento para esta línea</small>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" id="btnConfirmarArticulo">Añadir línea</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-secondary mt-3 mb-0" role="alert">
                    <i class="fas fa-info-circle me-2"></i>Busca un artículo por ID o nombre y añádelo al pedido. El total se recalculará automáticamente.
                </div>
            </div>
        </div>
        <% } else { %>
        <div class="alert alert-warning">
            <i class="fas fa-lock me-2"></i>Este pedido está en estado <strong><%= pedido.estado %></strong>; no es posible añadir nuevas líneas.
        </div>
        <% } %>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/pedido-acciones.js"></script>
    <% if (puedeAgregarLineas && articulosDisponibles && articulosDisponibles.length > 0) { %>
    <script>
        // Datos de artículos disponibles
        const articulos = <%- JSON.stringify(articulosDisponibles) %>;
        const pedidoId = <%= pedido.id %>;

        // Elementos del DOM
        const busquedaArticuloCabecera = document.getElementById('busquedaArticuloCabecera');
        const dropdownArticuloCabecera = document.getElementById('dropdownArticuloCabecera');
        const busquedaContainer = busquedaArticuloCabecera.closest('.articulo-search-container');
        const modalCantidadDescuento = new bootstrap.Modal(document.getElementById('modalCantidadDescuento'));
        const modalArticuloNombre = document.getElementById('modalArticuloNombre');
        const modalCantidad = document.getElementById('modalCantidad');
        const modalDescuento = document.getElementById('modalDescuento');
        const btnConfirmarArticulo = document.getElementById('btnConfirmarArticulo');
        
        let articuloSeleccionadoParaAgregar = null;

        // Función para filtrar artículos
        function filtrarArticulos(termino, articulosList) {
            if (!termino || termino.trim() === '') {
                return articulosList;
            }
            const terminoLower = termino.toLowerCase().trim();
            return articulosList.filter(articulo => {
                const id = String(articulo.Id || articulo.id || '');
                const nombre = String(articulo.Nombre || articulo.nombre || '').toLowerCase();
                return id.includes(terminoLower) || nombre.includes(terminoLower);
            });
        }

        // Función para renderizar dropdown de artículos
        function renderizarDropdownArticulos(dropdown, articulosFiltrados, onSelect) {
            dropdown.innerHTML = '';
            if (articulosFiltrados.length === 0) {
                dropdown.innerHTML = '<div class="articulo-dropdown-item text-muted text-center">No se encontraron artículos</div>';
                return;
            }
            articulosFiltrados.forEach(articulo => {
                const item = document.createElement('div');
                item.className = 'articulo-dropdown-item';
                item.innerHTML = `
                    <div class="articulo-item-id">ID: ${articulo.Id || articulo.id}</div>
                    <div class="articulo-item-name">${articulo.Nombre || articulo.nombre}</div>
                `;
                item.addEventListener('click', () => {
                    onSelect(articulo);
                });
                dropdown.appendChild(item);
            });
        }

        // Función para agregar artículo desde la búsqueda
        const agregarArticuloDesdeBusqueda = (articulo) => {
            articuloSeleccionadoParaAgregar = articulo;
            const nombreArticulo = `${articulo.Id || articulo.id} - ${articulo.Nombre || articulo.nombre}`;
            modalArticuloNombre.textContent = nombreArticulo;
            modalCantidad.value = '1';
            modalDescuento.value = '0';
            modalCantidad.classList.remove('is-invalid');
            busquedaArticuloCabecera.value = '';
            dropdownArticuloCabecera.classList.remove('show');
            modalCantidadDescuento.show();
            setTimeout(() => {
                modalCantidad.focus();
                modalCantidad.select();
            }, 300);
        };

        // Confirmar y agregar línea desde el modal
        btnConfirmarArticulo.addEventListener('click', () => {
            if (!articuloSeleccionadoParaAgregar) return;
            
            const cantidad = Number(modalCantidad.value) || 0;
            if (cantidad <= 0) {
                modalCantidad.classList.add('is-invalid');
                modalCantidad.focus();
                return;
            }
            
            const descuento = Number(modalDescuento.value) || 0;
            
            // Crear formulario y enviar
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/dashboard/pedidos/${pedidoId}/lineas`;
            
            const articuloIdInput = document.createElement('input');
            articuloIdInput.type = 'hidden';
            articuloIdInput.name = 'articulo_id';
            articuloIdInput.value = articuloSeleccionadoParaAgregar.Id || articuloSeleccionadoParaAgregar.id;
            form.appendChild(articuloIdInput);
            
            const cantidadInput = document.createElement('input');
            cantidadInput.type = 'hidden';
            cantidadInput.name = 'cantidad';
            cantidadInput.value = cantidad;
            form.appendChild(cantidadInput);
            
            const descuentoInput = document.createElement('input');
            descuentoInput.type = 'hidden';
            descuentoInput.name = 'descuento';
            descuentoInput.value = descuento;
            form.appendChild(descuentoInput);
            
            document.body.appendChild(form);
            form.submit();
        });

        // Permitir confirmar con Enter en los campos del modal
        [modalCantidad, modalDescuento].forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    btnConfirmarArticulo.click();
                }
            });
        });

        // Evento de búsqueda en la cabecera
        busquedaArticuloCabecera.addEventListener('input', (e) => {
            const termino = e.target.value;
            if (termino.length >= 1) {
                const articulosFiltrados = filtrarArticulos(termino, articulos);
                renderizarDropdownArticulos(dropdownArticuloCabecera, articulosFiltrados, agregarArticuloDesdeBusqueda);
                dropdownArticuloCabecera.classList.add('show');
            } else {
                dropdownArticuloCabecera.classList.remove('show');
            }
        });

        // Evento para mostrar dropdown al hacer focus
        busquedaArticuloCabecera.addEventListener('focus', () => {
            if (busquedaArticuloCabecera.value.length >= 1) {
                const articulosFiltrados = filtrarArticulos(busquedaArticuloCabecera.value, articulos);
                renderizarDropdownArticulos(dropdownArticuloCabecera, articulosFiltrados, agregarArticuloDesdeBusqueda);
                dropdownArticuloCabecera.classList.add('show');
            }
        });

        // Cerrar dropdown al hacer click fuera
        document.addEventListener('click', (e) => {
            if (!busquedaContainer.contains(e.target)) {
                dropdownArticuloCabecera.classList.remove('show');
            }
        });
    </script>
    <% } %>
    <script id="actionsPayload" type="application/json">
    {
        "pedidoId": <%= pedido.id %>,
        "pedidoNumero": "<%= pedido.numero || pedido.id %>",
        "estado": "<%= pedido.estado || '' %>",
        "fecha": "<%= pedido.fecha || '' %>",
        "fechaEntrega": "<%= pedido.fechaEntrega || '' %>",
        "cliente": "<%= pedido.cliente || '' %>",
        "total": <%= pedido.total || 0 %>
    }
    </script>
    <script>
        function compartirPedido() {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: 'Pedido #<%= pedido.numero || pedido.id %>',
                    text: 'Pedido de <%= pedido.cliente %>',
                    url: url
                }).catch(err => console.log('Error al compartir:', err));
            } else {
                // Fallback: copiar al portapapeles
                navigator.clipboard.writeText(url).then(() => {
                    alert('URL copiada al portapapeles');
                }).catch(err => {
                    // Fallback manual
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('URL copiada al portapapeles');
                });
            }
        }

        async function enviarDocumentoWebhook(pedidoId, destinatario, tipoDocumento) {
            try {
                const confirmacion = confirm(`¿Enviar documento ${tipoDocumento} a ${destinatario}?`);
                if (!confirmacion) return;

                // Mostrar indicador de carga
                const btn = event.target.closest('.dropdown-item');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
                btn.disabled = true;

                const response = await fetch(`/dashboard/pedidos/${pedidoId}/webhook`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        destinatario: destinatario,
                        tipoDocumento: tipoDocumento
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    alert(`✅ Documento enviado correctamente a ${destinatario}`);
                } else {
                    alert(`❌ Error: ${data.error || 'No se pudo enviar el documento'}`);
                }

                // Restaurar botón
                btn.innerHTML = originalText;
                btn.disabled = false;
            } catch (error) {
                console.error('Error enviando documento:', error);
                alert('❌ Error al enviar el documento. Por favor, intenta nuevamente.');
                const btn = event.target.closest('.dropdown-item');
                if (btn) {
                    btn.disabled = false;
                }
            }
        }
    </script>
    <script src="/js/go-to-top.js"></script>

    <!-- Go to Top Button -->
    <button id="goToTop" class="go-to-top" title="Ir arriba">
        <i class="fas fa-arrow-up"></i>
    </button>
</body>
</html>
